<div class="gradient-mask fixed top-0 left-0 w-full h-6 md:h-16 z-[99] pointer-events-none bg-[var(--background)] opacity-0 transition-[background-color] duration-200">
  <slot />
</div>

<script>
  let mask: HTMLElement | null = null;
  let ticking = false;

  const updateMask = () => {
    if (!mask) {
      mask = document.querySelector(".gradient-mask") as HTMLElement;
    }
    if (!mask) {
      return;
    }

    const threshold = 64;
    const { scrollY } = window;

    if (scrollY >= threshold) {
      mask.style.opacity = "1";
    } else {
      mask.style.opacity = "0";
    }
  }

  const onScroll = () => {
    if (ticking) {
      return;
    }
    ticking = true;
    requestAnimationFrame(() => {
      updateMask();
      ticking = false;
    });
  }

  const initGradientMask = () => {
    mask = document.querySelector(".gradient-mask") as HTMLElement;
    updateMask();
  }

  document.addEventListener("astro:page-load", initGradientMask);
  window.addEventListener("scroll", onScroll, { passive: true });
</script>

<style>
  .gradient-mask {
    backdrop-filter: blur(1px);
    mask-image: linear-gradient(
      to bottom,
      black 0%,
      rgba(0, 0, 0, 0.738) 19%,
      rgba(0, 0, 0, 0.541) 34%,
      rgba(0, 0, 0, 0.382) 47%,
      rgba(0, 0, 0, 0.278) 56.5%,
      rgba(0, 0, 0, 0.194) 65%,
      rgba(0, 0, 0, 0.126) 73%,
      rgba(0, 0, 0, 0.075) 80.2%,
      rgba(0, 0, 0, 0.042) 86.1%,
      rgba(0, 0, 0, 0.021) 91%,
      rgba(0, 0, 0, 0.008) 95.2%,
      rgba(0, 0, 0, 0.002) 98.2%,
      transparent 100%
    );
    -webkit-mask-image: linear-gradient(
      to bottom,
      black 0%,
      rgba(0, 0, 0, 0.738) 19%,
      rgba(0, 0, 0, 0.541) 34%,
      rgba(0, 0, 0, 0.382) 47%,
      rgba(0, 0, 0, 0.278) 56.5%,
      rgba(0, 0, 0, 0.194) 65%,
      rgba(0, 0, 0, 0.126) 73%,
      rgba(0, 0, 0, 0.075) 80.2%,
      rgba(0, 0, 0, 0.042) 86.1%,
      rgba(0, 0, 0, 0.021) 91%,
      rgba(0, 0, 0, 0.008) 95.2%,
      rgba(0, 0, 0, 0.002) 98.2%,
      transparent 100%
    );
  }
</style>
